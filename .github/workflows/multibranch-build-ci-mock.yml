name: Mocked Multibranch Pipeline

on:
  push:
    branches:
      - '**'   # trigger on all branches

jobs:
  ci:
    runs-on: ubuntu-latest

    steps:
      # Stage: Checkout
      - name: Checkout
        uses: actions/checkout@v3

      # Stage: Commit message check
      - name: Check commit message for "break"
        run: |
          COMMIT_MSG="$(git log -1 --pretty=%B)"
          echo "Commit message: $COMMIT_MSG"
          if [[ "$COMMIT_MSG" == *"break"* ]]; then
            echo "Commit message contains 'break'. Aborting pipeline."
            exit 1
          fi

      # Stage: Build
      - name: Build
        run: |
          echo "=== BUILD STAGE ==="
          echo "Mock build step running..."

      # Stage: Test
      - name: Test
        run: |
          echo "=== TEST STAGE ==="
          echo "Mock test step running..."

      # Stage: Publish
      - name: Publish
        if: github.ref == 'refs/heads/main' || startsWith(github.ref, 'refs/heads/release')
        run: |
          echo "=== PUBLISH STAGE ==="
          echo "Mock publish step running (only for main/release branches)..."
