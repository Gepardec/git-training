name: Mocked Multibranch Pipeline

on:
  push:
    branches:
      - '**'   # trigger on all branches

jobs:
  checkout:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

  build:
    runs-on: ubuntu-latest
    needs: checkout
    steps:
      - name: Build
        run: |
          echo "=== BUILD JOB ==="
          echo "Mock build step running..."

  test:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Test
        run: |
          echo "=== TEST JOB ==="
          COMMIT_MSG="$(git log -1 --pretty=%B)"
          echo "Commit message: $COMMIT_MSG"
          if [[ "$COMMIT_MSG" == *"break"* ]]; then
            echo "Commit message contains 'break'. Aborting pipeline during TEST job."
            exit 1
          fi
          echo "Mock test step running..."

  publish:
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/main' || startsWith(github.ref, 'refs/heads/release')
    steps:
      - name: Publish
        run: |
          echo "=== PUBLISH JOB ==="
          echo "Mock publish step running (only for main/release branches)..."
