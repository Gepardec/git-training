= Git 101
Thomas Herzog
2018-12-19
:author: Thomas Herzog
:revnumber: {project-version}
:example-caption!:
ifndef::imagesdir[:imagesdir: generated-images]
ifndef::sourcedir[:sourcedir: ../../main/java]
:title-slide-background-image: 70s.jpg
:title-slide-transition: zoom
:title-slide-transition-speed: fast
:customcss: slides.css

== What is SVN?

.SVN System
[graphviz, svn-system, svg]
--
include::./graphviz/svn-system.dot[]
--

* Single central server
* Local working copy
* No server, no commit

=== How SVN stores data?

* Versions are represented as a tree
* A branch is a copied folder
* Versions are series of changes

=== How SVN Branch works?

.SVN Branch
[graphviz, svn-branch, svg]
--
include::./graphviz/svn-branch.dot[]
--

* Branch is a copy of a tree
* Files are only linked
* File is copied on write (Bubble up)
* SVN uses trees, not graphs

=== SVN Merge vs Reintegrate?

.SVN Merge
[graphviz, svn-merge, svg]
--
include::./graphviz/svn-merge.dot[]
--

.SVN Reintegrate
[graphviz, svn-reintegrate, svg]
--
include::./graphviz/svn-reintegrate.dot[]
--

* Merge: One up to all revisions
* Reintegrate: Always all revisions

== What is GIT?

.Git System
[graphviz, git-system, svg]
--
include::./graphviz/git-system.dot[]
--

* Distributed repositories
* Full repository on workstation
* No server, no problem

=== How Git stores data?

.Git Data Storage
[graphviz, git-data-storage, svg]
--
include::./graphviz/git-data-storage.dot[]
--

* Versions are represented as a graph
* Each version is a snapshot
* Snapshots contains whole state

=== What is a Git Commit, Branch, Tag?

.Git Commit, Branch, Tag Example
[graphviz, git-commit-branh-tag, svg]
--
include::./graphviz/git-commit-branch-tag.dot[]
--

* A commit is a hash
* A commit can be labeled __(branch, tag)__
* A label is a pointer to a commit __(hash)__
* Multiple labels __(pointers)__ for a commit possible
* A tag is a immutable reference to a commit

=== How Git Branching works?

.Git Branch Model    
[graphviz, git-branch-model, svg]
--
include::./graphviz/git-branch-model.dot[]
--

* Master branch holds released commits
* Dev branch contains unreleased commits  
* Feature branch contains feature commits
* Hotfix branches contains hotfix commits

=== When Git Fast Forward?  

.Git Fast Fwd. Situation
[graphviz, git-fast-fwd-1, svg]
--
include::./graphviz/git-fast-fwd-1.dot[]
--

* Master branch hasn't diverged from Hotfix branch
* Meaning, no commits in Master which are not in Hotfix branch

=== How To Git Fast Forward?  

.Git Fast Fwd. Solution
[graphviz, git-fast-fwd-2, svg]
--
include::./graphviz/git-fast-fwd-2.dot[]
--

* Just an ordinary merge, but no merge commit necessary
* Commits moved from Hotfix -> Master branch
* Master pointer fast forwarded to last commit

=== When Git Merge?   

.Git Merge Commit Situation
[graphviz, git-merge-1, svg]
--
include::./graphviz/git-merge-1.dot[]  
--

* Master has diverged from Hotfix branch
* But, both have a common ancestor

=== How To Git Merge?

.Git Merge Commit Solution
[graphviz, git-merge-2, svg]
--
include::./graphviz/git-merge-2.dot[] 
--

* Merge of **C 4** and **C 5** via new commit
* New commit has two predecessors (Merge Commit)
* Merge commit automatically created (If no conflict)

=== When Git Merge Conflict?

.Git Merge Conflict Situation
[graphviz, git-merge-conflict-1, svg]
--
include::./graphviz/git-merge-conflict-1.dot[]
--

* Master Branch diverged from Feature branch
* Master Branch commits not in feature branch
* Master has same file changed as Feature branch

=== How Resolve a Git Merge Conflict?

.Git Merge Conflict Solution
[graphviz, git-merge-conflict-2, svg]
--
include::./graphviz/git-merge-conflict-2.dot[]
--

* Just an ordinary merge but:
** Git pauses process __(Commit changes are now local changes)__
** Conflicts have to be manually resolved __(Each conflicting file)__
** Merge commit is manually created __(Commit conflict resolution an changes!!)__

=== When Git Rebase?

.Git Rebase Situation
[graphviz, git-rebase-1, svg]
--
include::./graphviz/git-rebase-1.dot[]
--

* Master branch diverged from Feature branch
* Same situation as with a Git Merge
* Rebasing does not produce a merge commit
* Replays Feature branch commit on Master branch

=== How To Git Rebase?

.Git Rebase Solution 
[graphviz, git-rebase-2, svg]
--
include::./graphviz/git-rebase-2.dot[]
--

* Start on common ancestor of Master and Feature branch
* Replay Feature branch commits on Master branch
* Master branch pointer moved to new last commit via fast fwd.
* No merge commit (Cleaner history)

== Git 101 Hands On 

* How to work with git in development scenarios with the CLI?
* How and when to use branches?
* How to resolve merge conflicts?

=== Scenario

.Scenario
[graphviz, git-scenario, svg]
--
include::./graphviz/git-scenario.dot[] 
--

* Developers are separated by teams
* Developers work on features/hotfixes the same time
* Conflicts will sometimes occur
* Hotfixes need always to be merged!

=== Prepare a Git Repository

* We want to create a git repository for our sources
* We want to initially check in our sources
* Our sources are a simple README.adoc file

[source,asciidoc]
--
= My app documentation
...
--

=== What has happened?

.Initialized Git Repository
[graphviz, git-scenario-1, svg]
-- 
include::./graphviz/git-scenario-1.dot[]
--

[source,bash]
--
include::./examples/101/101.sh[tag=init]
--

* Git created *.git* directory
* Branch *master* created by git

=== Prepare the branches

* We want to implement the standard *branch model* (master, dev, feature)
* We want branch *dev* to be the main branch
* We want branch *master* to only contain released commits

=== What has happened?

.Branch Model
[graphviz, git-scenario-2, svg]
--
include::./graphviz/git-scenario-2.dot[]
--

[source,bash]
--
include::./examples/101/101.sh[tag=branch-model]
--

* Pointer (Labels) have been created for the initial commit *(dev, feature)*
* Still, we have only one commit

=== Make the first release

* We want to make our first release
* We want to ensure that the released state cannot be changed at all

=== What has happened?

.First release tag
[graphviz, git-scenario-3, svg]
--
include::./graphviz/git-scenario-3.dot[]  
--

[source,bash]
--
include::./examples/101/101.sh[tag=first-release] 
--

* A special Pointer (Tag) has been created for the initial commit

=== Provide a fix for branch dev

* A bug was found on branch dev
* Seems the merge/pull request wasn't handled properly
* We want to provide a fix for the branch dev

=== What has happened?

.Diverging branches
[graphviz, git-scenario-4, svg]
--
include::./graphviz/git-scenario-4.dot[]
-- 

[source,bash]
--
include::./examples/101/101.sh[tag=conflicting-commit] 
--

=== Development on branch feature

* We want to develop a feature separated from others
* We want our commits to not interfere with those of other features
* Unfortunately, we will have to produce an conflict

=== What has happened?

.Feature development
[graphviz, git-scenario-5, svg]
--
include::./graphviz/git-scenario-5.dot[]
-- 
     
* Commits between branch *dev* and *feature* conflict
* For now, we have no problem, because we are on different branches
* We will have to take care of it, when we merge the conflicting branches

=== Provide a hotfix

* We have to fix a production problem
* We have to provide a fix for the current release
* We want an own branch holding the *hotfix* commits
* We want to release the hotfix 
* We want to ensure that the hotfix gets reintegrated!

=== What has happened?

.Hotfix branch
[graphviz, git-scenario-6, svg]
--
include::./graphviz/git-scenario-6.dot[]
-- 

* NOT DONE YET !!!!!!
